{
  "$schema": "https://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/groboclown/junco-vam/refs/heads/main/vac-v1.schema.json",
  "title": "Vulnerability Analysis Collection",
  "description": "A collection of analyses for how known vulnerabilities affect the software product.",
  "type": "object",
  "properties": {
    "$schema": {
      "title": "Document Schema",
      "description": "The schema ID that this document follows.",
      "type": "string",
      "enum": ["https://raw.githubusercontent.com/groboclown/junco-vam/refs/heads/main/vac-v1.schema.json"]
    },
    "product": { "$ref": "#/definitions/ProductDefinition" },
    "authors": {
      "title": "Author List",
      "description": "Mapping of the alias of an author to the author details.  The remainder of the document references the authors through the alias (map key).",
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": { "$ref": "#/definitions/AuthorDetail" }
      },
      "maxItems": 1000
    },
    "analyses": {
      "title": "Analysis List",
      "description": "List of all constructed vulnerability analysis items.",
      "type": "array",
      "items": { "$ref": "#/definitions/AnalysisGroup" },
      "maxItems": 1000
    }
  },
  "required": [ "$schema", "product", "analyses" ],
  "additionalProperties": false,
  "definitions": {
    "ProductDefinition": {
      "title": "Product Definition",
      "description": "Details of the product that this document covers.",
      "type": "object",
      "properties": {
        "name": {
          "title": "Product Name",
          "description": "The formal name of the product.",
          "type": "string"
        },
        "purl": { "$ref": "#/definitions/PUrl" },
        "organization": {
          "title": "Owning Organization",
          "description": "The organization responsible for the maintenance of the product.",
          "type": "string",
          "maxLength": 500
        }
      },
      "required": [ "name" ],
      "additionalProperties": false
    },
    "AuthorDetail": {
      "title": "Author Detail",
      "description": "Detailed information about an author referenced in this document.",
      "type": "object",
      "properties": {
        "name": {
          "title": "Author Name",
          "description": "Name of the author.  If it matches the 'organization', then, for attribution purposes, the organization counts as the author of this analysis.",
          "type": "string",
          "minLength": 1,
          "maxLength": 500
        },
        "organization": {
          "title": "Author's Associated Organization",
          "description": "Organization associated with the author.  As the details do not require this, it should be assumed to match the product's organization if not given.  By convention, individuals from outside the project unassociated with a specific organization should use 'individual'.",
          "type": "string",
          "maxLength": 500
        },
        "contact": {
          "title": "Author's Contact Information",
          "description": "List of methods to contact the author.",
          "type": "array",
          "minItems": 0,
          "maxItems": 30,
          "items": { "$ref": "#/definitions/ContactInformation" }
        }
      },
      "required": [ "name" ],
      "additionalProperties": true
    },
    "ContactInformation": {
      "title": "Author Contact Information",
      "description": "A method to contact the author.",
      "type": "object",
      "properties": {
        "method": {
          "title": "Contact Method",
          "description": "Method for contact, such as 'email', 'homepage', 'mastodon'.  The corresponding 'at' property reflects the location in the method's format.",
          "type": "string",
          "maxLength": 50
        },
        "at": {
          "title": "Contact Location",
          "description": "Location for contacting, dependent on the method.",
          "type": "string",
          "maxLength": 500
        }
      },
      "required": [ "method", "at" ],
      "additionalProperties": true
    },
    "PUrl": {
      "title": "Package URL",
      "description": "The Package URL (pURL).  For reference, see https://github.com/package-url/purl-spec/blob/master/PURL-SPECIFICATION.rst",
      "type": "string",
      "maxLength": 500,
      "pattern": "^pkg:[a-z][a-z0-9.+-]*(/[a-zA-Z0-9._~%!$()*-]+)*/[a-zA-Z0-9._~%!$()*-]+(@[a-zA-Z0-9._~%!$()*-]+)?([?][a-zA-Z0-9._~%!$&()=*-]+=[a-zA-Z0-9._~%!$&()=*-]*(&[a-zA-Z0-9._~%!$&()=*-]+=[a-zA-Z0-9._~%!$&()=*-]*)*)?(#[a-zA-Z0-9._~%!$&()=*-]+(/[a-zA-Z0-9._~%!$&()=*-]+)*)?$"
    },
    "Hash": {
      "title": "Hash Encoded",
      "description": "A hashed value and the corresponding hashing algorithm.",
      "type": "object",
      "properties": {
        "alg": {
          "title": "Algorithm",
          "description": "Algorithm name, such as 'sha1' and 'md5'",
          "type": "string",
          "minLength": 3,
          "maxLength": 10
        },
        "sig": {
          "title": "Hash Signature",
          "description": "Base64 encoded signature.",
          "type": "string",
          "maxLength": 1000
        }
      },
      "required": ["alg", "sig"],
      "additionalProperties": false
    },

    "AnalysisGroup": {
      "title": "Vulnerability Analysis",
      "description": "An analysis of one or more vulnerability, in terms of how it affects the product.",
      "type": "object",
      "properties": {
        "vid": {
          "title": "List of Vulnerability IDs",
          "description": "List of all the vulnerability identifiers (e.g. CVE) that this analysis covers.  Note that a vulnerability might exist in several analysis, as it may cover multiple dependencies or parts of the code.",
          "type": "array",
          "maxItems": 100,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50
          }
        },
        "deps": {
          "title": "Affected Dependencies",
          "description": "List of the direct dependency pURL affected by this vulnerability.",
          "type": "array",
          "maxItems": 100,
          "items": { "$ref": "#/definitions/PUrl" }
        },
        "trans-deps": {
          "title": "Affected Transitive Dependencies",
          "description": "List of the transitive dependency pURL affected by this vulnerability.",
          "type": "array",
          "maxItems": 100,
          "items": {
            "title": "Transitive Dependency",
            "description": "A path to a dependency through other dependencies.  It follows the direct child (first element in the list), to each children, to the affected dependency (last in the list).",
            "type": "array",
            "items": { "$ref": "#/definitions/PUrl" },
            "minLength": 2,
            "maxLength": 100
          }
        },
        "src": {
          "title": "Affected Sources",
          "description": "List of product source code under analysis.",
          "type": "array",
          "maxItems": 100,
          "items": { "$ref": "#/definitions/SourceFile" }
        },
        "ver": {
          "title": "Product Versions",
          "description": "Affected released product versions.",
          "type": "array",
          "maxItems": 100,
          "items": {
            "title": "Version Specification",
            "type": "object",
            "properties": {
              "version": {"type": "string", "maxLength": 100},
              "first": {"type": "string", "maxLength": 100},
              "last": {"type": "string", "maxLength": 100},
              "before": {"type": "string", "maxLength": 100},
              "architecture": {"type": "array", "items": {"type": "string"}}
            },
            "required": [],
            "additionalProperties": false
          }
        },
        "an": {
          "title": "Analyses",
          "description": "List of analysis for the issue.",
          "type": "array",
          "maxItems": 100,
          "items": { "$ref": "#/definitions/Analysis" }
        }
      },
      "required": ["vid", "ver", "an"],
      "additionalProperties": true
    },
    "SourceFile": {
      "title": "Source File",
      "description": "A single source file.  If lines are specified, then the hash signature must match the file's lines, in the line number order.",
      "type": "object",
      "properties": {
        "file": { "type": "string" },
        "lines": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1
          }
        },
        "hash": { "$ref": "#/definitions/Hash" }
      },
      "required": ["file"],
      "additionalProperties": true
    },
    "Analysis": {
      "title": "A single analysis of a vulnerability.",
      "type": "object",
      "properties": {
        "auth": {
          "title": "Author Aliases",
          "description": "List of all author aliases associated with this analysis.  The corresponding author information is found in the authors mapping.",
          "type": "array",
          "maxItems": 100,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          }
        },
        "on": {"type": "string", "format": "date"},
        "state": { "$ref": "#/definitions/Sbom16State" },
        "resp": { "$ref": "#/definitions/Sbom16Response" },
        "just": { "$ref": "#/definitions/Sbom16Justification" },
        "desc": {
          "title": "Analysis Description",
          "description": "Text describing the analysis, corresponding to the VEX 'detail'.",
          "type": "string",
          "maxLength": 10000
        }
      },
      "required": ["on", "state", "desc"],
      "additionalProperties": false
    },

    "Sbom16State": {
      "$comment": "From the SBOM 1.6 specification.",
      "type": "string",
      "title": "Impact Analysis State",
      "description": "Declares the current state of an occurrence of a vulnerability, after automated or manual analysis.",
      "enum": [
        "resolved",
        "resolved_with_pedigree",
        "exploitable",
        "in_triage",
        "false_positive",
        "not_affected"
      ],
      "meta:enum": {
        "resolved": "The vulnerability has been remediated.",
        "resolved_with_pedigree": "The vulnerability has been remediated and evidence of the changes are provided in the affected components pedigree containing verifiable commit history and/or diff(s).",
        "exploitable": "The vulnerability may be directly or indirectly exploitable.",
        "in_triage": "The vulnerability is being investigated.",
        "false_positive": "The vulnerability is not specific to the component or service and was falsely identified or associated.",
        "not_affected": "The component or service is not affected by the vulnerability. Justification should be specified for all not_affected cases."
      }
    },
    "Sbom16Justification": {
      "$comment": "From the SBOM 1.6 specification.",
      "type": "string",
      "title": "Impact Analysis Justification",
      "description": "The rationale of why the impact analysis state was asserted.",
      "enum": [
        "code_not_present",
        "code_not_reachable",
        "requires_configuration",
        "requires_dependency",
        "requires_environment",
        "protected_by_compiler",
        "protected_at_runtime",
        "protected_at_perimeter",
        "protected_by_mitigating_control"
      ],
      "meta:enum": {
        "code_not_present": "The code has been removed or tree-shaked.",
        "code_not_reachable": "The vulnerable code is not invoked at runtime.",
        "requires_configuration": "Exploitability requires a configurable option to be set/unset.",
        "requires_dependency": "Exploitability requires a dependency that is not present.",
        "requires_environment": "Exploitability requires a certain environment which is not present.",
        "protected_by_compiler": "Exploitability requires a compiler flag to be set/unset.",
        "protected_at_runtime": "Exploits are prevented at runtime.",
        "protected_at_perimeter": "Attacks are blocked at physical, logical, or network perimeter.",
        "protected_by_mitigating_control": "Preventative measures have been implemented that reduce the likelihood and/or impact of the vulnerability."
      }
    },
    "Sbom16Response": {
      "$comment": "From the SBOM 1.6 specification.",
      "type": "array",
      "title": "Response",
      "description": "A response to the vulnerability by the manufacturer, supplier, or project responsible for the affected component or service. More than one response is allowed. Responses are strongly encouraged for vulnerabilities where the analysis state is exploitable.",
      "items": {
        "type": "string",
        "enum": [
          "can_not_fix",
          "will_not_fix",
          "update",
          "rollback",
          "workaround_available"
        ],
        "meta:enum": {
          "can_not_fix": "Can not fix",
          "will_not_fix": "Will not fix",
          "update": "Update to a different revision or release",
          "rollback": "Revert to a previous revision or release",
          "workaround_available": "There is a workaround available"
        }
      }
    }
  }
}
